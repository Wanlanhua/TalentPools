<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="libs/bootstrap/css/bootstrap.css">
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="node_modules/distpicker/dist/distpicker.js"></script>
    <script src="libs/bootstrap/js/bootstrap.js"></script>
    <link rel="stylesheet" href="css/common.css">
    <script src="js/GlobalData.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>注册</title>


</head>

<body>
    <header>
        <div class="container">
            <!--公司logo-->
            <nav class="navbar navbar-default">
                <img width="120" height="50" src="images/22.png "></img>
            </nav>

        </div>
    </header>

    <!--进度条导航栏-->
    <div class="container text-center ">
        <h1>用户信息</h1>
        <div class="progressBar">
            <div class="col-lg-6 col-md-8 col-sm-10 col-xs-8 center-vertical point-box">
                <div class="point center-block">1</div>

                <div class="points hidden-xs"></div>
                <div class="points hidden-xs"></div>
                <div class="points hidden-xs"></div>
                <div class="points"></div>
                <div class="points"></div>
                <div class="points"></div>
                <div class="point-active center-block">2</div>

                <div class="points hidden-xs"></div>
                <div class="points hidden-xs"></div>
                <div class="points hidden-xs"></div>
                <div class="points"></div>
                <div class="points"></div>
                <div class="points"></div>

                <div class="point center-block">3</div>

                <div class="points hidden-xs"></div>
                <div class="points hidden-xs"></div>
                <div class="points hidden-xs"></div>
                <div class="points"></div>
                <div class="points"></div>
                <div class="points"></div>

                <div class="point center-block">4</div>
            </div>
        </div>
    </div>
    <!--注册表单-->
    <div class="container  text-center  registers">
        <table class="table table-bordered" id="test">
            <tbody>
                <caption>
                    <h2>信息登记表</h2>
                </caption>
                <div id="base">
                    <tr>
                        <th style="width:13%">姓名<span class="color-red">*</span></th>
                        <th style="width:13%"><input type="text" id="name"></th>
                        <th style="width:13%">性别<span class="color-red">*</span></th>
                        <th style="width:13%">
                            <input type="radio" value="man" name="sex" checked style="width:30%">男
                            <input type="radio" value="women" name="sex" style="width:30%">女
                        </th>
                        <th style="width:13%">民族<span class="color-red">*</span></th>
                        <th style="width:13%"><input type="text" id="nation"></th>
                        <th rowspan="4"></th>
                    </tr>
                    <tr>
                        <th>出生日期<span class="color-red">*</span></th>
                        <th><input type="date" id="birthdate"></th>
                        <th>身 高<span class="color-red">*</span></th>
                        <th><input type="number" id="height" placeholder="cm"></th>
                        <th>体重<span class="color-red">*</span></th>
                        <th><input type="number" id="weight" placeholder="kg"></th>
                    </tr>
                    <tr>
                        <th>学历<span class="color-red">*</span></th>

                        <th>
                            <select id="udegree" style="width: 100%;">
                                <option value="初中">初中</option>
                                <option value="高中">高中</option>
                                <option value="中专">中专</option>
                                <option value="大专">大专</option>
                                <option value="本科">本科</option>
                                <option value="其他">其他</option>
                            </select>
                        </th>
                        <th colspan="2">联系方式<span class="color-red">*</span></th>
                        <th colspan="2"><input type="number" id="contact" placeholder="电话"></th>
                    </tr>
                    <tr>
                        <th>身份证号<span class="color-red">*</span></th>
                        <th colspan="2"><input type="text" id="idcard"></th>
                        <th>工种<span class="color-red">*</span></th>
                        <th colspan="2"><input type="text" id="workplant"></th>
                    </tr>
                    <tr>
                        <th>现住址<span class="color-red">*</span></th>
                        <th colspan="2">
                            <div data-toggle="distpicker" id="target">
                                <!-- container -->
                                <select style="width:30%"></select><!-- 省 -->
                                <select style="width:30%"></select><!-- 市 -->
                                <select style="width:30%"></select><!-- 区 -->
                            </div>
                        </th>
                        <th>健康状况<span class="color-red">*</span></th>
                        <th><input type="text" id="health"></th>
                        <th>婚姻状况<span class="color-red">*</span></th>
                        <th><input type="text" id="marry"></th>
                    </tr>
                </div>
                <!-- 教育背景 -->
                <tr>
                    <th style="height:100px;vertical-align:middle" rowspan="3" colspan="1">教育背景</th>
                    <th style="vertical-align:middle" colspan="2">起 止 年 月</th>
                    <th style="vertical-align:middle">学 校 名 称</th>
                    <th style="vertical-align:middle">学历</th>
                    <th style="vertical-align:middle">学历获取方式</th>
                    <th style="vertical-align:middle">学校所在地</th>
                </tr>
                <tr>
                    <th colspan="2"><input type="date" name="estartdate"> - <input type="date" name="eenddate"></th>
                    <th><input type="text" name="schoolname"></th>
                    <th><input type="text" name="degree"></th>
                    <th><input type="text" name="takedegree"></th>
                    <th><input type="text" name="schoollocation"></th>

                </tr>
                <tr>
                    <th colspan="2"><input type="date" name="estartdate"> - <input type="date" name="eenddate"></th>
                    <th><input type="text" name="schoolname"></th>
                    <th><input type="text" name="degree"></th>
                    <th><input type="text" name="takedegree"></th>
                    <th><input type="text" name="schoollocation"></th>
                </tr>


                <!-- 工作经历 -->

                <tr>
                    <th style="height:140px;vertical-align:middle" rowspan="5" colspan="1">工作经历</th>
                    <th style="vertical-align:middle" colspan="2">起 止 年 月</th>
                    <th style="vertical-align:middle">工作单位</th>
                    <th style="vertical-align:middle">岗位</th>
                    <th style="vertical-align:middle">离职原因</th>
                    <th style="vertical-align:middle">证明人电话</th>
                </tr>
                <tr>
                    <th colspan="2"><input type="date" name="wstartdate"> - <input type="date" name="wenddate"></th>
                    <th><input type="text" name="job"></th>
                    <th><input type="text" name="post"></th>
                    <th><input type="text" name="resignreason"></th>
                    <th><input type="number" name="ztel"></th>
                </tr>
                <tr>
                    <th colspan="2"><input type="date" name="wstartdate"> - <input type="date" name="wenddate"></th>
                    <th><input type="text" name="job"></th>
                    <th><input type="text" name="post"></th>
                    <th><input type="text" name="resignreason"></th>
                    <th><input type="number" name="ztel"></th>
                </tr>
                <tr>
                    <th colspan="2"><input type="date" name="wstartdate"> - <input type="date" name="wenddate"></th>
                    <th><input type="text" name="job"></th>
                    <th><input type="text" name="post"></th>
                    <th><input type="text" name="resignreason"></th>
                    <th><input type="number" name="ztel"></th>
                </tr>
                <tr>
                    <th colspan="2"><input type="date" name="wstartdate"> - <input type="date" name="wenddate"></th>
                    <th><input type="text" name="job"></th>
                    <th><input type="text" name="post"></th>
                    <th><input type="text" name="resignreason"></th>
                    <th><input type="number" name="ztel"></th>
                </tr>


                <!-- 培训经历 -->
                <tr>
                    <th style="height:140px;vertical-align:middle" rowspan="5" colspan="2">培训经历</th>
                    <th style="vertical-align:middle" colspan="2">培训时间</th>
                    <th style="vertical-align:middle" colspan="2">培训机构</th>
                    <th style="vertical-align:middle">培训内容</th>
                </tr>
                <tr>
                    <th colspan="2"><input type="number" name="ptime" placeholder="月"></th>
                    <th colspan="2"><input type="text" name="pplace"></th>
                    <th><input type="text" name="pcontent"></th>
                </tr>
                <tr>
                    <th colspan="2"><input type="number" name="ptime" placeholder="月"></th>
                    <th colspan="2"><input type="text" name="pplace"></th>
                    <th><input type="text" name="pcontent"></th>
                </tr>
                <tr>
                    <th colspan="2"><input type="number" name="ptime" placeholder="月"></th>
                    <th colspan="2"><input type="text" name="pplace"></th>
                    <th><input type="text" name="pcontent"></th>
                </tr>
                <tr>
                    <th colspan="2"><input type="number" name="ptime" placeholder="月"></th>
                    <th colspan="2"><input type="text" name="pplace"></th>
                    <th><input type="text" name="pcontent"></th>
                </tr>
                <!-- 证书资格 -->
                <tr>
                    <th style="height:120px;vertical-align:middle" rowspan="5" colspan="2">资格证书</th>
                    <th style="vertical-align:middle">颁发时间</th>
                    <th style="vertical-align:middle" colspan="2">证书名称</th>
                    <th style="vertical-align:middle" colspan="2">颁发机构</th>

                </tr>
                <tr>
                    <th><input type="date" name="qtime"></th>
                    <th colspan="2"><input type="text" name="qname"></th>
                    <th colspan="2"><input type="text" name="qplace"></th>
                </tr>
                <tr>
                    <th><input type="date" name="qtime"></th>
                    <th colspan="2"><input type="text" name="qname"></th>
                    <th colspan="2"><input type="text" name="qplace"></th>
                </tr>
                <tr>
                    <th><input type="date" name="qtime"></th>
                    <th colspan="2"><input type="text" name="qname"></th>
                    <th colspan="2"><input type="text" name="qplace"></th>
                </tr>
                <tr>
                    <th><input type="date" name="qtime"></th>
                    <th colspan="2"><input type="text" name="qname"></th>
                    <th colspan="2"><input type="text" name="qplace"></th>
                </tr>

                <!-- 家庭成员情况 -->
                <tr>
                    <th style="height:120px;vertical-align:middle" rowspan="3" colspan="2">家庭成员情况</th>
                    <th>关系</th>
                    <th>姓名</th>
                    <th colspan="2">工作单位</th>
                    <th colspan="1">联系方式</th>
                </tr>
                <tr>
                    <th><input type="text" name="mlink"></th>
                    <th><input type="text" name="mname"></th>
                    <th colspan="2"><input type="text" name="mworkplace"></th>
                    <th><input type="number" placeholder="电话" name="mtel"></th>
                </tr>
                <tr>
                    <th><input type="text" name="mlink"></th>
                    <th><input type="text" name="mname"></th>
                    <th colspan="2"><input type="text" name="mworkplace"></th>
                    <th><input type="number" placeholder="电话" name="mtel"></th>
                </tr>


                <!-- 自我评价 -->
                <tr>
                    <th rowspan="2" colspan="2" style="vertical-align:middle">自我评价</th>
                    <th colspan="5">个人优点、缺点、专长、工作业绩、爱好、职业规划等</th>
                </tr>
                <tr>
                    <th colspan="5"><input type="text" id="selfcheck"></th>
                </tr>
                <!-- 公司评价 -->
                <tr>
                    <th rowspan="2" colspan="2" style="vertical-align:middle">公司评价</th>
                    <th colspan="5">工作能力、工作态度、工作成绩、成长潜力、品行等。</th>
                </tr>
                <tr>
                    <th colspan="5"><input type="text" id="companycheck"></th>
                </tr>
            </tbody>
        </table>
    </div>

    <div style="text-align: center">
        <Button type="button" id="next" class="next-button inputs">下一步
    </div>

    <script>
        let username = "";
        let password = "";
        $(document).ready(function () {
            //接收多值
            $(manyValues);
            function manyValues() {
                var url = window.location.search;
                if (url.indexOf("?") != -1) {
                    var str = url.substr(1);
                    strs = str.split("&").map(item => {
                        return item.split("=");
                    });
                    username = strs[0][1];
                    password = strs[1][1];
                    console.log(username, password)
                }
            }


            //点击下一步
            $("#next").click(function () {
                let formdata = new FormData();
                let trlist = document.getElementsByTagName("tr");
                let reg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
                // 验证身份证
                if (reg.test(document.getElementById("idcard").value) === false) {
                    alert("身份证输入不合法");
                    return false;
                }
                //验证表单不为空
                for (let i = 0; i < trlist.length; i++) {
                    //获取前五行和后两行
                    if (i < 5) {
                        let thlist = trlist[i].querySelectorAll("input");
                        for (let j = 0; j < thlist.length; j++) {
                            if (thlist[j].value == "" || thlist[j].value == null) {
                                alert("信息不能为空!");
                                thlist[j].focus();
                                return (false);
                            }
                        }
                    }
                }
                //接收基础数据，给formdata赋值
                let input_cart = document.getElementsByTagName("INPUT");
                for (let i = 0; i < input_cart.length; i++) {
                    if (input_cart[i].id) {
                        formdata.append(input_cart[i].id, input_cart[i].value);
                    }
                }
                //设置学历
                let udegree = document.querySelector("#udegree").value
                
                formdata.append("udegree",udegree)
                //设置性别
                formdata.append("sex", $('input[name=sex]:checked').val());
                //设置所在地
                let placelist = document.querySelector("#target").querySelectorAll("select");
                let gzd = placelist[0].value;
                for (let i = 1; i < placelist.length; i++) {
                    gzd = gzd + "-" + placelist[i].value
                }
                formdata.append("gzd", gzd);
                //获取可选内容
                let info = new Map();
                for (let i = 0; i < input_cart.length; i++) {
                    if (input_cart[i].name != "" && input_cart[i].name != "sex") {
                        if (!info.has(input_cart[i].name)) {
                            info.set(input_cart[i].name, input_cart[i].value);
                        } else {
                            let temp = "";
                            temp = temp + info.get(input_cart[i].name)
                            info.set(input_cart[i].name, temp + ";" + input_cart[i].value);
                        }
                    }
                }
                // 给formdata赋值
                for (let [key, value] of info) {
                    formdata.append(key, value);
                }
                //添加suername
                formdata.append("username", username);
                formdata.append("password", password);
                console.log(convert_FormData_to_json2(formdata))
                //ajax提交
                $.ajax({
                    type: 'post',
                    dataType: 'json',
                    url: "/TalentPools/registered",
                    data: convert_FormData_to_json2(formdata),
                    success: function (res) {
                        console.log(res);
                        if (res == 1) {
                            alert("提交成功");
                            window.location.href = "register_step3.html?username=" + username + "&passwd=" + password;
                        } else if (res == 2) {
                            alert("插入失败");
                        } else {
                            alert("提交失败");
                        }

                    },
                    failed: function () {
                        alert("网络连接失败");
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        //如果状态码是500
                        if (XMLHttpRequest.status == 500) {
                            alert("请完善您一行内的信息");
                        }
                    }

                });
            })
        })
        //将formdata转化为json
        var convert_FormData_to_json2 = function (formData) {
            var objData = {};
            formData.forEach((value, key) => objData[key] = value);
            return JSON.parse(JSON.stringify(objData));
        };
        //取消默认省市县
        $('#target').distpicker({
            placeholder: false
        });


    </script>
</body>

</html>